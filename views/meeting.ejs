<!DOCTYPE html>
<html lang="tr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>BPL | BEÅžGEN KONSEY</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --erotic-red: #800020; --neon-cyan: #0ff; }
        body { background: #000; color: white; height: 100vh; overflow: hidden; font-family: 'Cinzel', serif; }

        /* BeÅŸgen Masa Dizilimi */
        .pentagon-grid {
            position: relative; width: 100vw; height: 60vh;
            display: flex; justify-content: center; align-items: center;
        }
        .v-slot {
            position: absolute; width: 140px; height: 140px;
            border: 2px solid var(--gold); border-radius: 50%;
            overflow: hidden; box-shadow: 0 0 15px var(--erotic-red);
            transition: 0.5s; cursor: pointer;
        }
        /* KÃ¶ÅŸe Dizilimleri (Matematiksel BeÅŸgen) */
        .v1 { top: 10%; } .v2 { top: 35%; left: 10%; } .v3 { top: 35%; right: 10%; }
        .v4 { bottom: 10%; left: 20%; } .v5 { bottom: 10%; right: 20%; }

        video { width: 100%; height: 100%; object-fit: cover; }

        /* SavaÅŸ Overlay - Victory Erotica */
        #battle-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000; text-align: center;
        }
        .victory-text {
            color: var(--gold); font-size: 4rem; text-shadow: 0 0 20px red;
            animation: pulse 1s infinite; margin-top: 20vh;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        .side-panel { background: rgba(15,15,15,0.9); border-top: 1px solid var(--gold); height: 40vh; }
        .gift-btn { background: var(--erotic-red); border: 1px solid var(--gold); font-size: 0.7rem; }
    </style>
</head>
<body>

    <div id="invite-bar" style="display:none;" class="alert alert-warning position-fixed top-0 w-100 z-3 shadow-lg">
        ðŸ”¥ Konseye Davet Edildin! <button onclick="joinVIP()" class="btn btn-sm btn-dark ms-3">KATIL</button>
    </div>

    <div class="pentagon-grid" id="video-area">
        <div class="v-slot v1" id="local-video-box">
            <video id="my-video" autoplay muted playsinline></video>
            <small class="position-absolute bottom-0 start-50 translate-middle-x bg-dark px-2">SÄ°Z</small>
        </div>
    </div>

    <div id="battle-overlay">
        <div class="victory-text" id="battle-status">HAZIRLANIN...</div>
        <video id="full-battle-video" style="max-width: 90vw; border: 3px solid var(--gold); margin-top: 20px;"></video>
    </div>

    <div class="side-panel p-3">
        <div class="row">
            <div class="col-7">
                <div id="vip-chat" style="height: 150px; overflow-y: auto; font-size: 0.8rem;" class="mb-2"></div>
                <input type="text" id="vip-msg" class="form-control form-control-sm bg-black text-white" placeholder="Sessizce fÄ±sÄ±lda...">
            </div>
            <div class="col-5 border-start border-secondary">
                <input type="text" id="gift-target" class="form-control form-control-sm mb-1" placeholder="Nick...">
                <div class="d-flex flex-wrap gap-1">
                    <button class="btn gift-btn" onclick="sendGiftVIP(50, 25)">50 (-%25)</button>
                    <button class="btn gift-btn" onclick="sendGiftVIP(250, 30)">250 (-%30)</button>
                    <button class="btn btn-warning btn-sm w-100 mt-2" onclick="initArena()">SAVAÅžA DAVET (200 BPL)</button>
                </div>
            </div>
        </div>
    </div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const myNickname = "<%= user.nickname %>";
    
    // Zoom Ã–zelliÄŸi
    document.addEventListener('click', (e) => {
        if(e.target.tagName === 'VIDEO') {
            e.target.parentElement.classList.toggle('zoomed-video');
        }
    });

    // SavaÅŸ ve Video MantÄ±ÄŸÄ±
    socket.on('battle-video-play', (data) => {
        const overlay = document.getElementById('battle-overlay');
        const video = document.getElementById('full-battle-video');
        const status = document.getElementById('battle-status');
        
        overlay.style.display = 'block';
        
        // Ã–nce Hamle Videosu (hayvanismi1.mp4)
        video.src = data.moveVideo;
        video.play();
        
        video.onended = () => {
            // Sonra Zafer Videosu (hayvanismi.mp4)
            status.innerHTML = `ðŸ† ZAFER: ${data.winner}`;
            status.style.color = "gold";
            video.src = data.video;
            video.play();
            
            video.onended = () => {
                setTimeout(() => {
                    location.href = '/profil'; // 48 saat yorgunluÄŸuyla profil sayfasÄ±na geri dÃ¶nÃ¼ÅŸ
                }, 2000);
            };
        };
    });

    function initArena() {
        const target = document.getElementById('gift-target').value;
        if(!target) return alert("Rakip seÃ§!");
        socket.emit('start-vip-battle', { room: "<%= roomId %>", p1: myNickname, p2: target });
    }

    function sendGiftVIP(amount, tax) {
        const target = document.getElementById('gift-target').value;
        socket.emit('send-gift-vip', { senderId: "<%= user._id %>", targetNick: target, amount, tax, room: "<%= roomId %>" });
    }
</script>

<style>
    .zoomed-video {
        position: fixed !important; top: 0 !important; left: 0 !important;
        width: 100vw !important; height: 100vh !important;
        z-index: 99999 !important; border-radius: 0 !important;
    }
</style>
</body>
</html>
