<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>BPL ARENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #000; color: #39FF14; font-family: monospace; }
        .opponent-card { border: 1px solid #39FF14; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .header { color: #FFFF00; text-align: center; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container py-5" style="max-width: 600px;">
        <h1 class="header">ARENA - CANLI RAKİPLER</h1>
        <div id="status" class="text-center mb-4">Rakip aranıyor... <span id="timer">18</span>s</div>
        
        <div id="player-list"></div>

        <div id="bot-card" style="display:none;" class="opponent-card border-warning text-warning">
            <span><b>ELITE BOT #001</b></span>
            <button class="btn btn-warning btn-sm" onclick="attackBot()">BOTLA SAVAŞ</button>
        </div>

        <a href="/profil" class="btn btn-outline-danger w-100 mt-4">ARENADAN ÇIK</a>
    </div>

    <script>
        const socket = io();
        let timeLeft = 18;
        
        socket.emit('join-arena', { id: "<%= user._id %>", nickname: "<%= user.nickname %>" });

        const timer = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if(timeLeft <= 0) {
                clearInterval(timer);
                document.getElementById('status').innerText = "RAKİP BULUNAMADI - BOT AKTİF";
                document.getElementById('bot-card').style.display = 'flex';
            }
        }, 1000);

        socket.on('arena-list-update', (players) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            players.forEach(p => {
                if(p.id !== "<%= user._id %>") {
                    list.innerHTML += `<div class="opponent-card"><span>${p.nickname}</span><button class="btn btn-success btn-sm">MEYDAN OKU</button></div>`;
                }
            });
        });

        async function attackBot() {
            const res = await fetch('/attack-bot', { method: 'POST' });
            const data = await res.json();
            alert(`Savaş Sonucu: ${data.winner}\nÖdül: ${data.reward} BPL`);
            location.href = '/profil';
        }
    </script>
</body>
</html>
