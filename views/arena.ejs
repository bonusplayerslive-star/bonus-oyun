<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BPL ARENA</title>
    <style>
        body { 
            background: #000; color: #39FF14; font-family: 'Courier New', monospace; 
            margin: 0; padding: 20px; -webkit-text-size-adjust: 100%;
        }
        .arena-box { max-width: 500px; margin: auto; }
        .opponent-card { 
            border: 1px solid #39FF14; padding: 15px; border-radius: 10px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(57, 255, 20, 0.05);
        }
        .btn-attack { 
            background: transparent; border: 1px solid #39FF14; color: #39FF14;
            padding: 10px 15px; border-radius: 5px; cursor: pointer;
            font-weight: bold; -webkit-tap-highlight-color: transparent;
        }
        .btn-attack:active { background: #39FF14; color: #000; }
        .header { text-align: center; color: #FFFF00; letter-spacing: 2px; }
    </style>
</head>
<body>

    <div class="arena-box">
        <h1 class="header">ARENA</h1>
        <p style="text-align: center;">Aktif Hayvan: <strong><%= selectedAnimal || (user.inventory[0] || 'Yok') %></strong></p>
        <p style="text-align: center; font-size: 0.8em; color: #888;">Bakiye: <span id="balance"><%= user.bpl %></span> BPL</p>

        <div id="opponents-list">
            <div class="opponent-card">
                <div>
                    <span style="color: #FFFF00;">Elite_Savaşçı</span><br>
                    <small>Güç: 85</small>
                </div>
                <button class="btn-attack" onclick="fight('BOT_123')">SALDIR</button>
            </div>
        </div>

        <a href="/profil" style="display:block; text-align:center; color:red; text-decoration:none; margin-top:20px;">← GERİ DÖN</a>
    </div>

    <script>
        async function fight(oppId) {
            const animal = "<%= selectedAnimal || user.inventory[0] %>";
            if(!animal || animal === 'undefined') return alert("Önce marketten bir hayvan almalısın!");

            if(!confirm("Savaşa girmek istediğine emin misin?")) return;

            try {
                const res = await fetch('/attack', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ defenderId: oppId, animalName: animal })
                });
                const data = await res.json();
                
                if(data.status === 'success') {
                    alert(`SAVAŞ BİTTİ!\nKazanan: ${data.winner}\nÖdül: ${data.reward} BPL`);
                    document.getElementById('balance').innerText = data.newBalance;
                } else {
                    alert(data.msg);
                }
            } catch(e) { alert("Bağlantı hatası!"); }
        }
    </script>
</body>
</html>
